# -*- coding: utf-8 -*-
import serial
import time
import sys

# UTF-8 ì¸ì½”ë”© ì„¤ì •
sys.stdout.reconfigure(encoding='utf-8')

# ì§ë ¬ í¬íŠ¸ ì„¤ì •
mega_port = "/dev/ttyUSB0"   # Mega ë³´ë“œ
uno_port_1 = "/dev/ttyUSB1"  # ì²« ë²ˆì§¸ Uno ë³´ë“œ

# ì§ë ¬ í¬íŠ¸ ì†ì„±
baud_rate = 9600  # ì•„ë‘ì´ë…¸ ê¸°ë³¸ ì „ì†¡ ì†ë„
timeout = 1       # ì‘ë‹µ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)

# Mega ë³´ë“œì™€ Uno ë³´ë“œì˜ ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²°
try:
    mega_serial = serial.Serial(mega_port, baud_rate, timeout=timeout)
    uno_serial_1 = serial.Serial(uno_port_1, baud_rate, timeout=timeout)
    print("âœ… ì§ë ¬ ì—°ê²°ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
except Exception as e:
    print(f"âš ï¸ ì§ë ¬ í¬íŠ¸ ì—´ê¸° ì˜¤ë¥˜: {e}")
    exit(1)

# ë°ì´í„° ì½ê³  ì „ë‹¬í•˜ëŠ” ë£¨í”„
try:
    while True:
        if mega_serial.in_waiting > 0:  # ìˆ˜ì‹ ëœ ë°ì´í„°ê°€ ìˆìœ¼ë©´
            received_data = mega_serial.readline().decode('utf-8').strip()
            print(f"ğŸ“© Megaì—ì„œ ìˆ˜ì‹ : {received_data}")

            if received_data == "1":
                uno_serial_1.write(b"1\n")  # Uno ë³´ë“œë¡œ "1" ì „ì†¡
                print("ğŸ“¤ '1'ì„ Uno ë³´ë“œë¡œ ì „ì†¡í•¨")

        time.sleep(0.1)  # CPU ì ìœ ìœ¨ ê°ì†Œë¥¼ ìœ„í•´ ëŒ€ê¸°

except KeyboardInterrupt:
    print("ğŸ›‘ í”„ë¡œê·¸ë¨ ì¢…ë£Œë¨.")

finally:
    # í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ì§ë ¬ í¬íŠ¸ ë‹«ê¸°
    mega_serial.close()
    uno_serial_1.close()
    print("ğŸ”Œ ì§ë ¬ í¬íŠ¸ê°€ ë‹«í˜”ìŠµë‹ˆë‹¤.")
